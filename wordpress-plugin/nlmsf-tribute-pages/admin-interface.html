<!-- NLMSF Tribute Pages Admin - Elementor Custom Block -->
<!-- This block provides the admin interface for managing tribute pages -->

<div class="nlmsf-tribute-admin">
    <div class="nlmsf-admin-header">
        <h1 class="nlmsf-admin-title">Tribute Pages Management</h1>
        <p class="nlmsf-admin-subtitle">Create, edit, and manage NLMSF tribute pages</p>
    </div>

    <!-- Add Tribute Section -->
    <div class="nlmsf-add-tribute-section">
        <h2 class="nlmsf-section-title">
            <i class="fas fa-plus-circle"></i>
            Add New Tribute Page
        </h2>
        
        <form id="nlmsf-add-tribute-form">
            <div class="nlmsf-form-grid">
                <div class="nlmsf-form-group">
                    <label class="nlmsf-form-label" for="tribute-name">Name *</label>
                    <input type="text" id="tribute-name" name="name" class="nlmsf-form-input" required 
                           placeholder="Enter person's name">
                </div>
                
                <div class="nlmsf-form-group">
                    <label class="nlmsf-form-label" for="tribute-slug">URL Slug *</label>
                    <input type="text" id="tribute-slug" name="slug" class="nlmsf-form-input" required 
                           placeholder="e.g., john-smith (leave blank to auto-generate)">
                    <small style="color: #6b7280; font-size: 0.75rem;">This will be used in the page URL: /tribute/[slug]</small>
                </div>
                
                <div class="nlmsf-form-group full-width">
                    <label class="nlmsf-form-label" for="tribute-biography">Biography *</label>
                    <textarea id="tribute-biography" name="biography" class="nlmsf-form-textarea" required 
                              placeholder="Enter the person's biography and remembrance message..."></textarea>
                </div>

                <div class="nlmsf-form-group full-width nlmsf-image-upload-section">
                    <label class="nlmsf-form-label">Tribute Image</label>
                    <div class="nlmsf-image-upload-controls">
                        <button type="button" id="nlmsf-upload-image-btn" class="nlmsf-btn nlmsf-btn-secondary">
                            <i class="fas fa-cloud-upload-alt"></i>
                            Upload Image
                        </button>
                        <span style="color: #6b7280;">or</span>
                        <input type="url" id="image-url" name="image_url" class="nlmsf-form-input" 
                               placeholder="Paste image URL here (e.g., from WordPress Media Library)">
                    </div>
                    <div id="nlmsf-image-preview" class="nlmsf-image-preview"></div>
                </div>
            </div>
            
            <div class="nlmsf-checkbox-group">
                <input type="checkbox" id="is-published" name="is_published" 
                       class="nlmsf-checkbox" checked>
                <label for="is-published" class="nlmsf-form-label">Publish immediately</label>
            </div>
            
            <button type="submit" class="nlmsf-btn nlmsf-btn-primary">
                <i class="fas fa-plus"></i>
                Create Tribute Page
            </button>
        </form>
    </div>

    <!-- Tributes List Section -->
    <div class="nlmsf-tributes-list-section">
        <h2 class="nlmsf-section-title">
            <i class="fas fa-list"></i>
            Manage Tribute Pages
        </h2>
        
        <div class="nlmsf-tributes-list">
            <!-- Tributes will be loaded here via JavaScript -->
            <div class="nlmsf-loading">
                <div class="nlmsf-loading-spinner"></div>
                <p>Loading tribute pages...</p>
            </div>
        </div>
    </div>
</div>

<!-- Edit Tribute Modal -->
<div id="nlmsf-edit-modal" class="nlmsf-modal-overlay">
    <div class="nlmsf-modal-content">
        <div class="nlmsf-modal-header">
            <h3 class="nlmsf-modal-title">Edit Tribute Page</h3>
            <button type="button" class="nlmsf-close-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form id="nlmsf-edit-tribute-form">
            <input type="hidden" name="id">
            
            <div class="nlmsf-form-grid">
                <div class="nlmsf-form-group">
                    <label class="nlmsf-form-label" for="edit-tribute-name">Name *</label>
                    <input type="text" id="edit-tribute-name" name="name" class="nlmsf-form-input" required>
                </div>
                
                <div class="nlmsf-form-group">
                    <label class="nlmsf-form-label" for="edit-tribute-slug">URL Slug *</label>
                    <input type="text" id="edit-tribute-slug" name="slug" class="nlmsf-form-input" required>
                </div>
                
                <div class="nlmsf-form-group full-width">
                    <label class="nlmsf-form-label" for="edit-tribute-biography">Biography *</label>
                    <textarea id="edit-tribute-biography" name="biography" class="nlmsf-form-textarea" required></textarea>
                </div>

                <div class="nlmsf-form-group full-width nlmsf-image-upload-section">
                    <label class="nlmsf-form-label">Tribute Image</label>
                    <div class="nlmsf-image-upload-controls">
                        <button type="button" id="nlmsf-edit-upload-image-btn" class="nlmsf-btn nlmsf-btn-secondary">
                            <i class="fas fa-cloud-upload-alt"></i>
                            Upload Image
                        </button>
                        <span style="color: #6b7280;">or</span>
                        <input type="url" id="edit-image-url" name="image_url" class="nlmsf-form-input" 
                               placeholder="Paste image URL here (e.g., from WordPress Media Library)">
                    </div>
                    <div id="nlmsf-edit-image-preview" class="nlmsf-image-preview"></div>
                </div>
            </div>
            
            <div class="nlmsf-checkbox-group">
                <input type="checkbox" id="edit-is-published" name="is_published" class="nlmsf-checkbox">
                <label for="edit-is-published" class="nlmsf-form-label">Published</label>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                <button type="button" class="nlmsf-btn nlmsf-close-modal" 
                        style="background: #6b7280; color: white;">
                    Cancel
                </button>
                <button type="submit" class="nlmsf-btn nlmsf-btn-primary">
                    <i class="fas fa-save"></i>
                    Update Tribute Page
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Manage Donors Modal -->
<div id="nlmsf-donors-modal" class="nlmsf-modal-overlay">
    <div class="nlmsf-modal-content">
        <div class="nlmsf-modal-header">
            <h3 class="nlmsf-modal-title">Manage Donors</h3>
            <button type="button" class="nlmsf-close-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Add Donor Form -->
        <div class="nlmsf-donors-section">
            <h4 class="nlmsf-section-title" style="font-size: 1.125rem; margin-bottom: 1rem;">
                <i class="fas fa-plus"></i>
                Add Donor
            </h4>
            
            <form id="nlmsf-add-donor-form">
                <div class="nlmsf-form-grid" style="gap: 1rem;">
                    <div class="nlmsf-form-group">
                        <label class="nlmsf-form-label" for="donor-name">Donor Name *</label>
                        <input type="text" id="donor-name" name="donor_name" class="nlmsf-form-input" required 
                               placeholder="Enter donor name">
                    </div>
                    
                    <div class="nlmsf-form-group">
                        <label class="nlmsf-form-label" for="donation-amount">Donation Amount</label>
                        <input type="number" id="donation-amount" name="donation_amount" class="nlmsf-form-input" 
                               step="0.01" min="0" placeholder="0.00">
                    </div>
                    
                    <div class="nlmsf-form-group">
                        <label class="nlmsf-form-label" for="donation-date">Donation Date</label>
                        <input type="date" id="donation-date" name="donation_date" class="nlmsf-form-input">
                    </div>
                    
                    <div class="nlmsf-form-group full-width">
                        <label class="nlmsf-form-label" for="donor-message">Message (Optional)</label>
                        <textarea id="donor-message" name="message" class="nlmsf-form-textarea" 
                                  placeholder="Personal message or note from donor"
                                  style="min-height: 80px;"></textarea>
                    </div>
                </div>
                
                <div class="nlmsf-checkbox-group" style="margin-bottom: 1rem;">
                    <input type="checkbox" id="is-anonymous" name="is_anonymous" class="nlmsf-checkbox">
                    <label for="is-anonymous" class="nlmsf-form-label">Anonymous Donor</label>
                </div>
                
                <button type="submit" class="nlmsf-btn nlmsf-btn-primary">
                    <i class="fas fa-plus"></i>
                    Add Donor
                </button>
            </form>
        </div>

        <!-- Bulk Add Donors -->
        <div class="nlmsf-donors-section" style="margin-top: 2rem; border-top: 2px solid #7e22ce; padding-top: 2rem; background: linear-gradient(135deg, rgba(126, 34, 206, 0.05), rgba(67, 56, 202, 0.03)); border-radius: 0.75rem;">
            <h4 class="nlmsf-section-title" style="font-size: 1.125rem; margin-bottom: 1rem;">
                <i class="fas fa-list"></i>
                Bulk Add Donors
            </h4>
            
            <div style="background: #f8fafc; padding: 1.5rem; border-radius: 0.5rem; border: 1px solid #e5e7eb; margin-bottom: 1rem;">
                <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 0.9rem;">
                    <i class="fas fa-info-circle" style="color: #7e22ce; margin-right: 0.5rem;"></i>
                    Paste a list of donor names (one per line) to add them all at once. Each name will be added as an individual donor with today's date.
                </p>
                
                <form id="nlmsf-bulk-add-donors-form">
                    <div class="nlmsf-form-group" style="margin-bottom: 1rem;">
                        <label class="nlmsf-form-label" for="bulk-donor-names">Donor Names (one per line) *</label>
                        <textarea id="bulk-donor-names" name="donor_names" class="nlmsf-form-textarea" 
                                  placeholder="John Smith&#10;Jane Doe&#10;Mike Johnson&#10;Sarah Wilson&#10;..." 
                                  style="min-height: 150px; font-family: monospace; font-size: 0.9rem;" required></textarea>
                        <small style="color: #6b7280; font-size: 0.8rem; margin-top: 0.5rem; display: block;">
                            Enter each donor name on a separate line. Empty lines will be ignored.
                        </small>
                    </div>
                    
                    <div class="nlmsf-form-grid" style="grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div class="nlmsf-form-group">
                            <label class="nlmsf-form-label" for="bulk-donation-amount">Default Donation Amount (Optional)</label>
                            <input type="number" id="bulk-donation-amount" name="donation_amount" class="nlmsf-form-input" 
                                   step="0.01" min="0" placeholder="0.00">
                        </div>
                        
                        <div class="nlmsf-form-group">
                            <label class="nlmsf-form-label" for="bulk-donation-date">Default Donation Date</label>
                            <input type="date" id="bulk-donation-date" name="donation_date" class="nlmsf-form-input">
                        </div>
                    </div>
                    
                    <div class="nlmsf-checkbox-group" style="margin-bottom: 1rem;">
                        <input type="checkbox" id="bulk-is-anonymous" name="is_anonymous" class="nlmsf-checkbox">
                        <label for="bulk-is-anonymous" class="nlmsf-form-label">Mark all as Anonymous Donors</label>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <button type="submit" class="nlmsf-btn nlmsf-btn-primary">
                            <i class="fas fa-list"></i>
                            Bulk Add Donors
                        </button>
                        <span id="bulk-add-status" style="color: #6b7280; font-size: 0.9rem;"></span>
                    </div>
                </form>
            </div>
        </div>

        <!-- Donors List -->
        <div style="margin-top: 2rem;">
            <h4 class="nlmsf-section-title" style="font-size: 1.125rem; margin-bottom: 1rem;">
                <i class="fas fa-users"></i>
                Current Donors
            </h4>
            <div class="nlmsf-donors-list">
                <div class="nlmsf-loading">
                    <div class="nlmsf-loading-spinner"></div>
                    <p>Loading donors...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Initialize Tribute Admin -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-generate slug from name
    const nameInput = document.getElementById('tribute-name');
    const slugInput = document.getElementById('tribute-slug');
    
    if (nameInput && slugInput) {
        nameInput.addEventListener('input', function() {
            if (!slugInput.value || slugInput.dataset.autoGenerated === 'true') {
                const slug = this.value
                    .toLowerCase()
                    .replace(/[^a-z0-9]+/g, '-')
                    .replace(/(^-|-$)/g, '');
                slugInput.value = slug;
                slugInput.dataset.autoGenerated = 'true';
            }
        });
        
        slugInput.addEventListener('input', function() {
            if (this.value) {
                slugInput.dataset.autoGenerated = 'false';
            }
        });
    }

    // Check if the NLMSF Tribute Manager is loaded
    if (typeof nlmsfTribute !== 'undefined') {
        // Manager is already initialized
        console.log('NLMSF Tribute Pages Manager loaded successfully');
    } else {
        console.error('NLMSF Tribute Pages Manager not loaded. Make sure the plugin is activated.');
        
        // Show error message to user
        const container = document.querySelector('.nlmsf-tributes-list');
        if (container) {
            container.innerHTML = `
                <div style="text-align: center; padding: 2rem; color: #ef4444; background: #fef2f2; border-radius: 0.5rem; border: 1px solid #fecaca;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                    <h3>Plugin Not Loaded</h3>
                    <p>The NLMSF Tribute Pages Manager plugin is not active. Please activate the plugin to use this feature.</p>
                </div>
            `;
        }
    }
});
</script>

